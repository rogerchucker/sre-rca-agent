version: 1

# -------------------------------------------------------------------
# Provider instances available to the agent in THIS environment
# -------------------------------------------------------------------
# These are concrete, configured tool endpoints.
# Subjects bind to these by ID.
# -------------------------------------------------------------------

providers:

  # ===============================================================
  # LOG STORE
  # ===============================================================
  - id: "log_store_1"
    category: "log_store"
    type: "loki"                     # adapter selector (not used by core)
    capabilities:
      operations:
        - "query.signature_counts"
        - "query.samples"
    config:
      base_url_env: "LOG_STORE_URL"
      auth:
        kind: "none"                 # bearer_env | oauth_env | basic_env
        token_env: "LOG_STORE_TOKEN"

  # ===============================================================
  # VERSION CONTROL SYSTEM
  # ===============================================================
  - id: "vcs_1"
    category: "vcs"
    type: "github"
    capabilities:
      operations:
        - "list_changes"
    config:
      token_env: "VCS_TOKEN"

      # Subject → repo mapping
      # This keeps subject.yaml clean if you prefer centralized mapping
      repo_map:
        hn-backend-demo: "rogerchucker/hn-feed"
        hn-worker-demo: "rogerchucker/hn-feed"
        hn-cron-demo: "rogerchucker/hn-feed"

  # ===============================================================
  # DEPLOYMENT TRACKER (CI/CD as deploy source)
  # ===============================================================
  - id: "deploy_1"
    category: "deploy_tracker"
    type: "github_actions"
    capabilities:
      operations:
        - "list_deployments"
        - "get_deployment_metadata"
    config:
      token_env: "DEPLOY_TOKEN"

      # Subject → repo mapping
      repo_map:
        hn-backend-demo: "rogerchucker/hn-feed"
        hn-worker-demo: "rogerchucker/hn-feed"

      # Subject → workflow mapping
      workflow_path_map:
        hn-backend-demo: ".github/workflows/deploy.yml"
        hn-worker-demo: ".github/workflows/deploy.yml"

      # Structured markers emitted in workflow logs
      # (adapter extracts these deterministically)
      markers:
        environment: "DEPLOY_ENV="
        service: "DEPLOY_SERVICE="
        sha: "DEPLOY_SHA="
        version: "DEPLOY_VERSION="
        image: "DEPLOY_IMAGE="
        result: "DEPLOY_RESULT="
        finished_at: "DEPLOY_FINISHED_AT="

  # ===============================================================
  # BUILD TRACKER (CI WORKFLOW RUNS)
  # ===============================================================
  - id: "build_1"
    category: "build_tracker"
    type: "github_actions"
    capabilities:
      operations:
        - "list_builds"
    config:
      token_env: "BUILD_TOKEN"
      repo_map:
        hn-backend-demo: "rogerchucker/hn-feed"
        hn-worker-demo: "rogerchucker/hn-feed"
        hn-cron-demo: "rogerchucker/hn-feed"
      workflow_path_map:
        hn-backend-demo: ".github/workflows/build.yml"
        hn-worker-demo: ".github/workflows/build.yml"
        hn-cron-demo: ".github/workflows/build.yml"
      markers:
        environment: "BUILD_ENV="
        service: "BUILD_SERVICE="
        sha: "BUILD_SHA="
        version: "BUILD_VERSION="
        image: "BUILD_IMAGE="
        result: "BUILD_RESULT="

  # ===============================================================
  # RUNTIME (KUBECTL)
  # ===============================================================
  - id: "runtime_1"
    category: "runtime"
    type: "kubectl"
    capabilities:
      operations:
        - "get_logs"
        - "get_events"
    config:
      kubeconfig_env: "KUBECONFIG"
      context: "KUBE_CONTEXT"
      namespace_map:
        hn-backend-demo: "default"
        hn-worker-demo: "default"
        hn-cron-demo: "default"
      selector_map:
        hn-backend-demo: "app=hn-backend-demo"
        hn-worker-demo: "app=hn-worker-demo"
        hn-cron-demo: "app=hn-cron-demo"

  # ===============================================================
  # METRICS STORE
  # ===============================================================
  - id: "metrics_1"
    category: "metrics_store"
    type: "prometheus"
    capabilities:
      operations:
        - "query_range"
    config:
      base_url_env: "METRICS_URL"
      auth:
        kind: "none"
        token_env: "METRICS_TOKEN"

  # ===============================================================
  # TRACE STORE
  # ===============================================================
  - id: "trace_1"
    category: "trace_store"
    type: "jaeger"
    capabilities:
      operations:
        - "search_traces"
    config:
      base_url_env: "TRACE_URL"
      auth:
        kind: "none"
        token_env: "TRACE_TOKEN"
