version: 1

subjects:
  - name: "SUBJECT_NAME"
    environment: "production"
    aliases: ["subject-name", "subject_name"]

    bindings:
      log_store: "log_store_1"
      deploy_tracker: "deploy_1"
      vcs: "vcs_1"

    log_evidence:
      stream_selectors:
        job: "SUBJECT_NAME"
        level: "ERROR"
        exporter: "OTLP"
      parse:
        format: "json"
        fields:
          env: "resources.deployment.environment"
          version: "resources.service.version"
          err_type: "attributes.error.type"
          err_msg: "attributes.error.message"
          route: "attributes.http.route"
          status: "attributes.http.status_code"
          trace_id: "attributes.otelTraceID"
      # optional: defaults for all investigations on this subject
      default_filters:
        min_level: "ERROR"

    deploy_context:
      # optional if your deploy_tracker provider config already maps subject->repo/workflow
      repo: "REPO_FULL_NAME"
      workflow_path: ".github/workflows/deploy.yml"

    vcs_context:
      # optional if your vcs provider config already maps subject->repo
      repo: "REPO_FULL_NAME"

    known_failure_modes:
      - name: "deploy_regression"
        indicators:
          - "new error signature after deploy"
      - name: "dependency_import_error"
        indicators:
          - "ImportError"
          - "cannot import name"

    dependencies:
      - "database"
      - "cache"
      - "external_api"

    runbooks:
      - title: "Investigate 5xx spike"
        link: "https://RUNBOOK_LINK"