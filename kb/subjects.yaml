version: 1

subjects:
  # --- Subject 1 (existing demo) ---
  - name: "hn-backend-demo"
    environment: "production"
    aliases: ["hn-backend", "hn-feed-backend"]

    bindings:
      log_store: "log_store_1"
      deploy_tracker: "deploy_1"
      vcs: "vcs_1"
      build_tracker: "build_1"
      runtime: "runtime_1"
      metrics_store: "metrics_1"
      trace_store: "trace_1"

    log_evidence:
      stream_selectors:
        job: "hn-backend-demo"
        level: "ERROR"
        Exporter: "OTLP"
      parse:
        format: "json"
        fields:
          env: "resources.deployment.environment"
          version: "resources.service.version"
          err_type: "attributes.error.type"
          err_msg: "attributes.error.message"
          route: "attributes.http.route"
          status: "attributes.http.status_code"
          trace_id: "attributes.otelTraceID"
      default_filters:
        environment: "production"
      evidence_intents: ["signature_counts", "samples"]

    deploy_context:
      repo: "rogerchucker/hn-feed"
      workflow_path: ".github/workflows/deploy.yml"

    vcs_context:
      repo: "rogerchucker/hn-feed"

    known_failure_modes:
      - name: "deploy_regression"
        indicators: ["new error signature after deploy"]
      - name: "import_error"
        indicators: ["ImportError", "cannot import name"]


  # --- Subject 2 (shares same providers) ---
  - name: "hn-worker-demo"
    environment: "production"
    aliases: ["hn-worker", "worker"]

    bindings:
      log_store: "log_store_1"
      deploy_tracker: "deploy_1"
      vcs: "vcs_1"
      build_tracker: "build_1"
      runtime: "runtime_1"
      metrics_store: "metrics_1"
      trace_store: "trace_1"

    log_evidence:
      stream_selectors:
        job: "hn-worker-demo"
        level: "ERROR"
        Exporter: "OTLP"
      parse:
        format: "json"
        fields:
          env: "resources.deployment.environment"
          version: "resources.service.version"
          err_type: "attributes.error.type"
          err_msg: "attributes.error.message"
          route: "attributes.http.route"
          status: "attributes.http.status_code"
          trace_id: "attributes.otelTraceID"
      default_filters:
        environment: "production"
      evidence_intents: ["signature_counts", "samples"]

    deploy_context:
      repo: "rogerchucker/hn-feed"
      workflow_path: ".github/workflows/deploy.yml"

    vcs_context:
      repo: "rogerchucker/hn-feed"

    known_failure_modes:
      - name: "job_queue_poison_message"
        indicators: ["retry storm", "same error repeats"]


  # --- Subject 3 (NO deploy tracker â†’ graceful degradation) ---
  - name: "hn-cron-demo"
    environment: "production"
    aliases: ["hn-cron", "cron"]

    bindings:
      log_store: "log_store_1"
      vcs: "vcs_1"
      # NOTE: no deploy_tracker binding on purpose
      build_tracker: "build_1"
      runtime: "runtime_1"
      metrics_store: "metrics_1"
      trace_store: "trace_1"

    log_evidence:
      stream_selectors:
        job: "hn-cron-demo"
        level: "ERROR"
        Exporter: "OTLP"
      parse:
        format: "json"
        fields:
          env: "resources.deployment.environment"
          version: "resources.service.version"
          err_type: "attributes.error.type"
          err_msg: "attributes.error.message"
          route: "attributes.http.route"
          status: "attributes.http.status_code"
          trace_id: "attributes.otelTraceID"
      default_filters:
        environment: "production"
      evidence_intents: ["signature_counts", "samples"]

    vcs_context:
      repo: "rogerchucker/hn-feed"

    known_failure_modes:
      - name: "scheduled_task_failure"
        indicators: ["job failed", "timeout", "resource exhausted"]
